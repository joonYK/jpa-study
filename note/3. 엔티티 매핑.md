JPA는 엔티티와 테이블을 정확히 매핑하는것이 가장 중요. 매핑 방법은 xml과 어노테이션 중에서 일반적으로 어노테이션 방식을 많이 사용. 

* 대표 어노테이션
    * 객체와 테이블 매핑 : @Entity, @Table
    * 기본 키 매핑 : @Id
    * 필드와 컬럼 매핑 : @Column
    * 연관관계 매핑 : @ManyToOne, @JoinColumn
    
## @Entity

테이블과 매핑할 클래스는 @Entitiy 어노테이션을 필수로 적용, JPA가 관리하는 클래스로 엔티티라고 한다.
name 속성값을 줘서 엔티티 이름을 지정할 수 있고, 생략하면 클래스 이름을 사용.
    
### 주의사항

* 기본 생성자는 필수.
* final 클래스, enum, interface, inner 클래스는 사용 불가.
* 저장할 필드에 final 사용 불가.

<br/>

## @Table

엔티티와 매핑할 테이블을 지정.

* 속성
    * name : 매핑할 테이블 이름. 생략하면 엔티티 이름을 사용.
    * catalog : catalog 기능이 있는 DB에서 catalog 매핑.
    * schema : schema 기능이 있는 DB에서 schema를 매핑.
    * uniqueConstraints : DDL 생설 시에 유니크 제약조건을 만듦. 스미카 자동 생성 기능을 사용해서 DDL을 만들 때만 사용.
  
## 데이터베이스 스키마 자동 생성

persistence.xml에 아래 설정을 추가하면 애플리케이션 실행 시점에 테이블을 자동으로 생성한다.

```xml
<!-- 스키마 자동 생성 기능 -->
<property name="hibernate.hbm2ddl.auto" value="create" />
<!-- 하이버네이트가 실행한 SQL을 출력 -->
<property name="hibernate.show_sql" value="true" />
```

자동 생성 기능은 데이터베이스 방언에 따라 필드 타입을 알맞게 생성한다. 예를 들어, H2는 varchar 타입을 오라클은 varchar2 타입으로 생성한다.

* 속성
  * create : 기존 테이블을 삭제하고 새로 생성.
  * create-drop : 애플리케이션 종료할 때 생성한 DLL을 제거.
  * update : 테이블과 엔티티 매핑정보를 비교해서 변경 사항만 수정.
  * validate : 테이블과 엔티티 매핑정보를 비교해서 차이 없으면 경고를 남기고 애플리케이션 실행 안 함.
  * none : 자동 생성 기능을 사용하지 않음.

### 참고사항

* 자동 생성 기능은 편리하지만 운영 환경에서 사용할만큼 완벽하지 않기 때문에 개발 환경에서만 사용하는것이 좋다.
* JPA 2.1부터는 스키마 자동 생성 기능을 표준으로 지원하지만, 하이버네이트의 update, validate는 지원하지 않는다.

<br/>

## DDL 생성 기능

DDL 생성 시에 다양한 제약조건을 추가할 수 있다. 

* 필드에 제약 조건 추가.
```java
    // 회원 이름은 필수로 입력, 10자를 초과하면 안 됨.
    @Column(name = "NAME", nullable = false, length = 10)
    private String username;
```

* 테이블 유니크 제약조건
```java
@Table(name = "MEMBER", uniqueConstraints = {@UniqueConstraint(
    name = "NAME_AGE_UNIQUE",
    columnNames = {"NAME", "AGE"})
})
```

이외에도 여러 제약조건이 있다. 
제약조건은 DDL을 자동 생성할 때만 사용되기 때문에 직접 DDL을 만든다면 사용할 이유가 없지만, 
개발자가 엔티티만 보고 쉽게 제약조건을 파악할 수 있는 장점이 있다.

<br/>

## 기본 키 매핑

기본 키는 `@Id` 어노테이션으로 매핑한다. 기본키는 MySQL의 AUTO_INCREMENT 기능처럼 자동 할당하는 방법이 있다.<br/>

### JPA가 제공하는 기본 키 생성 전략

@GeneratedValue 어노테이션으로 설정하며, 데이터베이스 벤더마다 지원하는 방식이 다르기때문에 아래와 같은 다양한 전략을 사용한다.

* 직접 할당 : 기본 키를 애플리케이션에서 직접 할당.
* 자동 생성 : 대리 키 사용 방식.
  * IDENTITY : 데이터베이스에 위임. (MySQL의 AUTO_INCREMENT)
  * SEQUENCE : 데이터베이스의 시퀀스를 이용해서 할당. (오라클의 시퀀스)
  * TABLE : 키 생성 테이블을 사용. (키 생성용 테이블을 하나 만들어두고 마치 시퀀스처럼 사용)
  
**※ 주의 사항**

키 생성 전략을 위해 persistence.xml에 아래와 같은 설정 추가 필요.
```xml
<property name="hibernate.id.new_generator_mappings" value="true"/>
```

### 적용 가능한 자바 타입

* 기본 자바형
* 자바 래퍼형
* String
* java.util.Date
* Java.sql.Date
* java.math.BigDecimal
* Java.math.BigInteger



  
  
