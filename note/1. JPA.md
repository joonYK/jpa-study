# JPA

JPA(Java Persistence API)는 자바 진영의 `ORM 기술에 대한 API 표준 명세`이다. 
그래서 JPA는 `구현체가 아닌 인터페이스의 모음`이며, ORM 프레임워크가 만족해야하는 `기술명세를 정의`한 것이다.

## ORM이란?

ORM(Object-Relational Mapping)은 `객체와 관계형 데이터베이스를 매핑하는 기술`로, 객체와 테이블을 매핑해서 패러다임의 불일치를 개발자 대신 해결한다.
예로, 객체를 컬렉션 저장하듯 ORM 프레임워크에 저장하면 알아서 INSERT SQL을 생성해서 데이터베이스에 저장한다.

개발시에 객체는 객체대로 모델링에 집중하고, 관계형 데이터베이스는 데이터베이스대로 모델링해서 어떻게 매핑하는지만 ORM 프레임워크에 알려주면 된다.
그래서 개발자는 데이터 중심인 데이터베이스에 종속되지 않고 객체지향 애플리케이션 개발에 집중할 수 있다.
여러 ORM 프레임워크가 있지만, 자바 진영에선 `하이버네이트를 가장 많이 사용`한다.

하이버네이트 이전에 EJB에 엔티티 빈이라는 ORM 기술이 존재했지만, J2EE 서버에서만 동작하고 사용하기 까다로웠다.
그래서 당시 만들어진 하이버네이트라는 오픈소스 ORM 프레임워크를 기반으로 EJB 3.0 버전에서 새로운 자바 ORM 기술 표준이 만들어졌는데, 이것이 JPA이다.

<br/>

## JPA를 사용해야하는 이유

### 생산성
* SQL을 작성하고 JDBC API를 사용하는 반복적인 일을 대신 처리.
* JPA는 DML외에 DLL문도 자동으로 생성.
* 데이터베이스 설계 중심에서 객체 설계 중심으로 개발 가능.

### 유지보수
* SQL을 직접다루면 엔티티에 필드를 하나만 추가해도 등록, 수정, 조회에 대한 JDBC API 코드 수정 필요.
    * JPA는 대신 처리해주기 때문에 유지보수 해야할 코드 수가 감소.
* 패러다임 불일치 문제를 해결해주어 객체 지향언어의 장점 활용.
    * 유지보수하기 좋은 도메인 모델 설계 가능.
    
### 패러다임의 불일치 해결

#### 1. 상속
* RDB의 테이블은 상속이라는 개념이 없음.
* 슈퍼타입 서브타입 관계를 사용하면 객체 상속과 유사한 형태의 테이블 설계 가능.
    * 슈퍼타입 서브타입에 대한 테이블 2개가 만들어져서 하나의 객체를 분해해서 각 테이블에 맞게 SQL을 작성해야 함.
    * JPA는 알아서 두 테이블 각각에 대한 등록, 수정 쿼리를 작성하고 조회할때는 조인을 함.

#### 2. 연관관계
* 객체는 참조에 접근해서 연관된 객체를 조회.
* 테이블은 외래 키를 사용해서 조인을 통해 연관된 테이블을 조회.
* 객체 모델과 테이블의 연관관계를 맺는 방식의 차이를 JPA가 해결.
    * JPA는 참조를 외래 키로 변환해서 적절한 INSERT SQL을 데이터베이스에 전달.
    * 조회할 때는 외래 키를 참조로 변환.

#### 3. 객체 그래프 탐색
* 객체 그래프 탐색 : 객체에서 참조를 사용해 연관된 객체를 찾는 것. ex) Team team = member.getTeam();
* 객체는 마음껏 객체 그래프를 탐색할 수 있어야 함. ex) member.getOrder().getOrderItem()...
* SQL을 직접 다루면 처음 실행하는 SQL에 따라 객체 그래프를 어디까지 탐색할 수 있는지 정해짐.
    * 어디까지 객체 그래프 탐색이 가능한지 알아보려면 SQL을 직접 확인.
    * 엔티티가 SQL에 논리적으로 종속.
* JPA는 연관된 객체를 사용하는 시점에 적절한 SELECT SQL을 실행. (지연 로딩)
    * 처음에 모두 join으로 조회하는 방법도 존재.

#### 4.비교
* DB는 기본 키의 값으로 각 로우(row)를 구분.
* 객체는 동일선(identity)와 동등성(equality) 비교 2가지 방법이 존재.
    * 동일성 : == 비교. 객체 인스턴스 주소값 비교.
    * 동등성 : equals() 메소드를 사용해서 객체 내부의 값 비교.
* 같은 기본 키 값의 회원 객체를 2번 조회하면 각각 다른 인스턴스이므로 동일성은 false.
    * 데이터베이스의 같은 로우를 조회했지만 동일성 비교는 실패.
* JPA는 같은 트랜잭션일 때 같은 객체가 조회되는것을 보장.

### 성능
* 애플리케이션과 데이터베이스 사이에서 동작하기 때문에 최적화에 대한 다양한 시도.
    * 트랜잭션 안에서 회원 조회를 2번하면 JDBC API는 매번 DB에 직접 접근, JPA는 한번 DB에서 조회하고 이후는 회원 객체를 재사용.

### 데이터 접근 추상화와 벤더 독립성
* RDB는 같은 기능도 벤더마다 사용법이 다른 경우가 많음. 
* JPA는 애플리케이션과 DB 사이에 추상화된 데이터 접근 계층을 제공.
    * 애플리케이션이 특정 DB 기술에 종속되지 않음. 
    * 만약 DB를 변경하면 JPA에게 다른 DB를 사용한다는 통보만 하면 됨.

### 표준
* JPA는 자바 진영의 ORM 기술 표준이기 때문에 다른 구현 기술로 손쉽게 변경 가능.


